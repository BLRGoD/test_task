[0m22:06:43.983123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5df4067a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5df30f05e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5df30f06d0>]}


============================== 22:06:43.997840 | 2ccabcbc-545f-417f-8fa0-86eb51f5c6b8 ==============================
[0m22:06:43.997840 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:06:44.000272 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt init dbt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:06:44.045462 [info ] [MainThread]: Setting up your profile.
[0m22:06:44.059156 [error] [MainThread]: Encountered an error:
Runtime Error
  No adapters available. Learn how to install an adapter by going to https://docs.getdbt.com/docs/connect-adapters#install-using-the-cli
[0m22:06:44.066073 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": false, "command_wall_clock_time": 0.44984195, "process_in_blocks": "1392", "process_kernel_time": 1.144681, "process_mem_max_rss": "86652", "process_out_blocks": "16", "process_user_time": 6.440077}
[0m22:06:44.074491 [debug] [MainThread]: Command `dbt init` failed at 22:06:44.073785 after 0.46 seconds
[0m22:06:44.076248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5df4067a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5df30f0a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5df30f09d0>]}
[0m22:06:44.077486 [debug] [MainThread]: Flushing usage events
[0m22:06:45.085521 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:03.349232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55b2097a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55b2fb7c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55b2fb7bb0>]}


============================== 22:07:03.366420 | e6523f10-087b-4c33-bb13-226e01f77b86 ==============================
[0m22:07:03.366420 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:07:03.378641 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m22:07:03.396104 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'clickhouse_profile'
[0m22:07:03.398761 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.5303365, "process_in_blocks": "0", "process_kernel_time": 0.994081, "process_mem_max_rss": "86260", "process_out_blocks": "8", "process_user_time": 9.340224}
[0m22:07:03.410558 [debug] [MainThread]: Command `dbt run` failed at 22:07:03.410174 after 0.54 seconds
[0m22:07:03.411542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55b2097a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55b2fb6d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55b2fb54b0>]}
[0m22:07:03.412583 [debug] [MainThread]: Flushing usage events
[0m22:07:04.154840 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:46.954007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30344df940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30353cfa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30353cfa30>]}


============================== 22:07:46.968294 | 36ba68cd-0da1-4b4e-a4e2-cbda87cab9a2 ==============================
[0m22:07:46.968294 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:07:46.977361 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:07:47.002759 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.clickhouse'
[0m22:07:47.008808 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "clickhouse_profile", target "dev" invalid: Runtime Error
    Could not find adapter type clickhouse!
[0m22:07:47.019826 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.40640315, "process_in_blocks": "0", "process_kernel_time": 1.003541, "process_mem_max_rss": "86396", "process_out_blocks": "8", "process_user_time": 7.88642}
[0m22:07:47.021335 [debug] [MainThread]: Command `dbt run` failed at 22:07:47.021011 after 0.41 seconds
[0m22:07:47.022323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30344df940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30353ccc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30353ce950>]}
[0m22:07:47.023662 [debug] [MainThread]: Flushing usage events
[0m22:07:47.937090 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:34.497518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4905bcb9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f490691fb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f490691fac0>]}


============================== 22:09:34.525073 | 17246482-3df4-40a1-bf1d-528062d8eef7 ==============================
[0m22:09:34.525073 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:09:34.538753 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:09:34.563038 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.clickhouse'
[0m22:09:34.567333 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "clickhouse_profile", target "dev" invalid: Runtime Error
    Could not find adapter type clickhouse!
[0m22:09:34.574684 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.7795399, "process_in_blocks": "24", "process_kernel_time": 1.229189, "process_mem_max_rss": "86336", "process_out_blocks": "16", "process_user_time": 8.945191}
[0m22:09:34.576307 [debug] [MainThread]: Command `dbt run` failed at 22:09:34.575934 after 0.78 seconds
[0m22:09:34.577489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4905bcb9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f490691ccd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f490691e9e0>]}
[0m22:09:34.587327 [debug] [MainThread]: Flushing usage events
[0m22:09:35.664878 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:10.561491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb247663b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb24700bac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb24700bcd0>]}


============================== 22:14:10.570351 | f640d4ac-9aec-43be-a96b-dac5070d60a0 ==============================
[0m22:14:10.570351 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:14:10.573142 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:14:10.816913 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "clickhouse_profile", target "dev" invalid: Runtime Error
        schema: raw_data 
        database: default 
        cluster: None 
    On Clickhouse, database must be omitted or have the same value as schema.
[0m22:14:10.821088 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.42101833, "process_in_blocks": "0", "process_kernel_time": 0.170166, "process_mem_max_rss": "88032", "process_out_blocks": "8", "process_user_time": 3.533459}
[0m22:14:10.823562 [debug] [MainThread]: Command `dbt run` failed at 22:14:10.822985 after 0.42 seconds
[0m22:14:10.825764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb247663b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb245b251b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb245b25300>]}
[0m22:14:10.832185 [debug] [MainThread]: Flushing usage events
[0m22:14:11.748691 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:15:37.900185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11c32fb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11a90fb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11a90caf0>]}


============================== 22:15:37.918638 | 5c1c5f1a-4c67-4d4d-b469-b8ffe31ea6fa ==============================
[0m22:15:37.918638 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:15:37.921825 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:15:38.365033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c1c5f1a-4c67-4d4d-b469-b8ffe31ea6fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11c25d5a0>]}
[0m22:15:38.487184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c1c5f1a-4c67-4d4d-b469-b8ffe31ea6fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11c621960>]}
[0m22:15:38.488597 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:15:38.617588 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found more than one package with the name "dbt" included in this project. Package names must be unique in a project. Please rename one of these packages.
[0m22:15:38.620232 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.96768916, "process_in_blocks": "520", "process_kernel_time": 0.170113, "process_mem_max_rss": "90972", "process_out_blocks": "8", "process_user_time": 4.883258}
[0m22:15:38.621952 [debug] [MainThread]: Command `dbt run` failed at 22:15:38.621661 after 0.97 seconds
[0m22:15:38.622689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11c32fb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11a90db10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa11a69fa30>]}
[0m22:15:38.623517 [debug] [MainThread]: Flushing usage events
[0m22:15:39.377712 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:19:26.492179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f349518bb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3494b4bac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3494b4bcd0>]}


============================== 22:19:26.496295 | 64fc56f7-2848-42f7-a894-cc0d6d5e155d ==============================
[0m22:19:26.496295 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:19:26.497686 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:19:26.893601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f34935bdcf0>]}
[0m22:19:27.048416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3493673c40>]}
[0m22:19:27.050572 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:19:27.238119 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:19:27.239890 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:19:27.241320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f349435ba00>]}
[0m22:19:31.708579 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:19:31.727040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f349376c8e0>]}
[0m22:19:31.987497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f349310afe0>]}
[0m22:19:31.989940 [info ] [MainThread]: Found 2 models, 468 macros
[0m22:19:31.992064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f349310a620>]}
[0m22:19:32.000771 [info ] [MainThread]: 
[0m22:19:32.005964 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:19:32.042754 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:19:32.088339 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:19:33.091407 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:19:33.120153 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:19:33.249952 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:19:33.284251 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:19:33.342450 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m22:19:33.353063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3494fb4790>]}
[0m22:19:33.356876 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:19:33.362392 [info ] [MainThread]: 
[0m22:19:33.383200 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m22:19:33.389914 [info ] [Thread-1 (]: 1 of 2 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m22:19:33.393406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m22:19:33.395561 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m22:19:33.427874 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:19:33.432458 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m22:19:33.526206 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m22:19:33.559405 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:19:33.562181 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(timestamp) AS month,
        from_currency,
        to_currency,
        rate
    FROM raw_data.exchange_rates
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:19:33.605198 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(timestamp) AS month,
        from_currency,
        to_currency,
        rate
    FROM raw_data.exchange_rates
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:19:33.611043 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 81.
  DB::Exception: Database raw_data does not exist. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String>(int, FormatStringHelperImpl<std::type_identity<String>::type>, String&&) @ 0x000000000863c36b
  3. DB::DatabaseCatalog::getDatabase(String const&) const @ 0x0000000011a52896
  4. DB::Context::resolveStorageID(DB::StorageID, DB::Context::StorageNamespace) const @ 0x00000000119739de
  5. DB::IdentifierResolver::tryResolveTableIdentifierFromDatabaseCatalog(DB::Identifier const&, std::shared_ptr<DB::Context const>) @ 0x00000000117ae41f
  6. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176fd37
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011752705
  8. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  9. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  11. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  12. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  13. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  14. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  15. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  16. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  17. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  18. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  19. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  20. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  21. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  22. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  23. DB::TCPHandler::run() @ 0x00000000136cc378
  24. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  25. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  26. Poco::PooledThread::run() @ 0x00000000165d3ddc
  27. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  28. ? @ 0x00007f41c6b52ac3
  29. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:19:33.616218 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3490ab3d60>]}
[0m22:19:33.618271 [error] [Thread-1 (]: 1 of 2 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.22s]
[0m22:19:33.622273 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m22:19:33.624398 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:19:33.628376 [info ] [Thread-1 (]: 2 of 2 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:19:33.630835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_prj.average_exchange_rate_monthly, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:19:33.632315 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:19:33.642019 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:19:33.644130 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:19:33.653510 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_weekly
[0m22:19:33.657275 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:19:33.658834 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,
        from_currency,
        to_currency,
        AVG(rate) AS average_rate
    FROM raw_data.exchange_rates
    WHERE to_currency = 'USD'
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:19:33.667804 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,
        from_currency,
        to_currency,
        AVG(rate) AS average_rate
    FROM raw_data.exchange_rates
    WHERE to_currency = 'USD'
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:19:33.673338 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 81.
  DB::Exception: Database raw_data does not exist. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String>(int, FormatStringHelperImpl<std::type_identity<String>::type>, String&&) @ 0x000000000863c36b
  3. DB::DatabaseCatalog::getDatabase(String const&) const @ 0x0000000011a52896
  4. DB::Context::resolveStorageID(DB::StorageID, DB::Context::StorageNamespace) const @ 0x00000000119739de
  5. DB::IdentifierResolver::tryResolveTableIdentifierFromDatabaseCatalog(DB::Identifier const&, std::shared_ptr<DB::Context const>) @ 0x00000000117ae41f
  6. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176fd37
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011752705
  8. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  9. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  11. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  12. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  13. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  14. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  15. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  16. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  17. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  18. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  19. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  20. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  21. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  22. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  23. DB::TCPHandler::run() @ 0x00000000136cc378
  24. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  25. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  26. Poco::PooledThread::run() @ 0x00000000165d3ddc
  27. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  28. ? @ 0x00007f41c6b52ac3
  29. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:19:33.675957 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64fc56f7-2848-42f7-a894-cc0d6d5e155d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3490685cc0>]}
[0m22:19:33.678171 [error] [Thread-1 (]: 2 of 2 ERROR creating sql view model `default`.`average_exchange_rate_weekly` .. [[31mERROR[0m in 0.05s]
[0m22:19:33.682009 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:19:33.686711 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:19:33.688275 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:19:33.689408 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:19:33.691053 [info ] [MainThread]: 
[0m22:19:33.692571 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.69 seconds (1.69s).
[0m22:19:33.696926 [debug] [MainThread]: Command end result
[0m22:19:33.862966 [info ] [MainThread]: 
[0m22:19:33.864915 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m22:19:33.867246 [info ] [MainThread]: 
[0m22:19:33.874536 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 81.
  DB::Exception: Database raw_data does not exist. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String>(int, FormatStringHelperImpl<std::type_identity<String>::type>, String&&) @ 0x000000000863c36b
  3. DB::DatabaseCatalog::getDatabase(String const&) const @ 0x0000000011a52896
  4. DB::Context::resolveStorageID(DB::StorageID, DB::Context::StorageNamespace) const @ 0x00000000119739de
  5. DB::IdentifierResolver::tryResolveTableIdentifierFromDatabaseCatalog(DB::Identifier const&, std::shared_ptr<DB::Context const>) @ 0x00000000117ae41f
  6. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176fd37
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011752705
  8. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  9. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  11. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  12. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  13. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  14. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  15. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  16. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  17. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  18. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  19. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  20. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  21. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  22. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  23. DB::TCPHandler::run() @ 0x00000000136cc378
  24. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  25. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  26. Poco::PooledThread::run() @ 0x00000000165d3ddc
  27. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  28. ? @ 0x00007f41c6b52ac3
  29. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:19:33.883965 [info ] [MainThread]: 
[0m22:19:33.892580 [error] [MainThread]:   Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 81.
  DB::Exception: Database raw_data does not exist. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String>(int, FormatStringHelperImpl<std::type_identity<String>::type>, String&&) @ 0x000000000863c36b
  3. DB::DatabaseCatalog::getDatabase(String const&) const @ 0x0000000011a52896
  4. DB::Context::resolveStorageID(DB::StorageID, DB::Context::StorageNamespace) const @ 0x00000000119739de
  5. DB::IdentifierResolver::tryResolveTableIdentifierFromDatabaseCatalog(DB::Identifier const&, std::shared_ptr<DB::Context const>) @ 0x00000000117ae41f
  6. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176fd37
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011752705
  8. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  9. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  11. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  12. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  13. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  14. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  15. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  16. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  17. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  18. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  19. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  20. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  21. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  22. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  23. DB::TCPHandler::run() @ 0x00000000136cc378
  24. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  25. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  26. Poco::PooledThread::run() @ 0x00000000165d3ddc
  27. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  28. ? @ 0x00007f41c6b52ac3
  29. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:19:33.893793 [info ] [MainThread]: 
[0m22:19:33.894634 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m22:19:33.905331 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.558845, "process_in_blocks": "120", "process_kernel_time": 0.442093, "process_mem_max_rss": "132868", "process_out_blocks": "3064", "process_user_time": 11.615007}
[0m22:19:33.906882 [debug] [MainThread]: Command `dbt run` failed at 22:19:33.906446 after 7.56 seconds
[0m22:19:33.908030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f349518bb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f34932cf160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3490581390>]}
[0m22:19:33.909052 [debug] [MainThread]: Flushing usage events
[0m22:19:35.183657 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:23:12.278782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58592e3be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5857882e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5857883fa0>]}


============================== 22:23:12.288192 | 2a895e0b-7bac-49bc-ae00-42d2617845d9 ==============================
[0m22:23:12.288192 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:23:12.290296 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models test', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:23:12.820510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a895e0b-7bac-49bc-ae00-42d2617845d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5857720880>]}
[0m22:23:13.038635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a895e0b-7bac-49bc-ae00-42d2617845d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58578f6ef0>]}
[0m22:23:13.041098 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:23:13.261974 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:23:13.559230 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m22:23:13.560870 [debug] [MainThread]: Partial parsing: added file: dbt_prj://models/test.sql
[0m22:23:14.355268 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:23:14.380481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a895e0b-7bac-49bc-ae00-42d2617845d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58572601f0>]}
[0m22:23:14.915744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a895e0b-7bac-49bc-ae00-42d2617845d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f585692a5c0>]}
[0m22:23:14.918204 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:23:14.920046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a895e0b-7bac-49bc-ae00-42d2617845d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5856929f00>]}
[0m22:23:14.935061 [info ] [MainThread]: 
[0m22:23:14.938553 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:23:14.948151 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:23:15.000276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:15.551308 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:23:15.563323 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:23:15.789322 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:23:15.822403 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:23:15.854411 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:23:15.860937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a895e0b-7bac-49bc-ae00-42d2617845d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f585695dc00>]}
[0m22:23:15.863202 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:23:15.864555 [info ] [MainThread]: 
[0m22:23:15.874374 [debug] [Thread-1 (]: Began running node model.dbt_prj.test
[0m22:23:15.877354 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`test` ................................... [RUN]
[0m22:23:15.879469 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.test)
[0m22:23:15.880913 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.test
[0m22:23:15.931289 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.test"
[0m22:23:15.933319 [debug] [Thread-1 (]: Began executing node model.dbt_prj.test
[0m22:23:16.005891 [debug] [Thread-1 (]: Creating new relation test
[0m22:23:16.041618 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.test"
[0m22:23:16.043679 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */


  create view `default`.`test` 
  
    
    
  as (
    SELECT 1;
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:23:16.058223 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */


  create view `default`.`test` 
  
    
    
  as (
    SELECT 1;
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:23:16.064188 [debug] [Thread-1 (]: Database Error in model test (models/test.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 205 (end of query) (line 9, col 13): ;
      
    )
        
        
                      -- end_of_sql
                      
                      . Expected one of: token, DoubleColon, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, alias, AS, identifier, Comma, FROM, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::createDeprecated(String const&, int, bool) @ 0x000000000d7b708d
  2. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x00000000140dd332
  3. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d44a1
  4. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  5. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  6. DB::TCPHandler::run() @ 0x00000000136cc378
  7. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  8. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  9. Poco::PooledThread::run() @ 0x00000000165d3ddc
  10. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  11. ? @ 0x00007f41c6b52ac3
  12. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/test.sql
[0m22:23:16.069634 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a895e0b-7bac-49bc-ae00-42d2617845d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5854b39bd0>]}
[0m22:23:16.071972 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`test` .......................... [[31mERROR[0m in 0.19s]
[0m22:23:16.075700 [debug] [Thread-1 (]: Finished running node model.dbt_prj.test
[0m22:23:16.082159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:23:16.083451 [debug] [MainThread]: Connection 'model.dbt_prj.test' was left open.
[0m22:23:16.084808 [debug] [MainThread]: On model.dbt_prj.test: Close
[0m22:23:16.086575 [info ] [MainThread]: 
[0m22:23:16.087933 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.15 seconds (1.15s).
[0m22:23:16.092002 [debug] [MainThread]: Command end result
[0m22:23:16.201022 [info ] [MainThread]: 
[0m22:23:16.203208 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:23:16.205735 [info ] [MainThread]: 
[0m22:23:16.208156 [error] [MainThread]:   Database Error in model test (models/test.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 205 (end of query) (line 9, col 13): ;
      
    )
        
        
                      -- end_of_sql
                      
                      . Expected one of: token, DoubleColon, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, alias, AS, identifier, Comma, FROM, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::createDeprecated(String const&, int, bool) @ 0x000000000d7b708d
  2. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x00000000140dd332
  3. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d44a1
  4. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  5. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  6. DB::TCPHandler::run() @ 0x00000000136cc378
  7. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  8. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  9. Poco::PooledThread::run() @ 0x00000000165d3ddc
  10. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  11. ? @ 0x00007f41c6b52ac3
  12. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/test.sql
[0m22:23:16.210020 [info ] [MainThread]: 
[0m22:23:16.211440 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:23:16.213974 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.139842, "process_in_blocks": "16", "process_kernel_time": 0.329407, "process_mem_max_rss": "135372", "process_out_blocks": "3000", "process_user_time": 7.98564}
[0m22:23:16.216669 [debug] [MainThread]: Command `dbt run` failed at 22:23:16.215783 after 4.14 seconds
[0m22:23:16.219933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58592e3be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5857c8b2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5857c88c40>]}
[0m22:23:16.221960 [debug] [MainThread]: Flushing usage events
[0m22:23:17.268343 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:23:46.065184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770dbc3c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770c002590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770c0025f0>]}


============================== 22:23:46.073322 | 2c11bb5a-137d-4775-a163-357e72395977 ==============================
[0m22:23:46.073322 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:23:46.075095 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:23:46.636240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c11bb5a-137d-4775-a163-357e72395977', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770c0d5870>]}
[0m22:23:46.844631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c11bb5a-137d-4775-a163-357e72395977', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770c0a9720>]}
[0m22:23:46.846890 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:23:47.144252 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:23:47.522841 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:23:47.525818 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/test.sql
[0m22:23:48.594664 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:23:48.610544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2c11bb5a-137d-4775-a163-357e72395977', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770b240070>]}
[0m22:23:48.806771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2c11bb5a-137d-4775-a163-357e72395977', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770b21d1e0>]}
[0m22:23:48.808480 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:23:48.809785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c11bb5a-137d-4775-a163-357e72395977', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770b21d210>]}
[0m22:23:48.814744 [info ] [MainThread]: 
[0m22:23:48.817551 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:23:48.820284 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:23:48.854810 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:49.453281 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:23:49.463182 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:23:49.665831 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:23:49.688263 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:23:49.709700 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:23:49.715501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c11bb5a-137d-4775-a163-357e72395977', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770b21cb80>]}
[0m22:23:49.717553 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:23:49.718883 [info ] [MainThread]: 
[0m22:23:49.728710 [debug] [Thread-1 (]: Began running node model.dbt_prj.test
[0m22:23:49.731373 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`test` ................................... [RUN]
[0m22:23:49.734396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.test)
[0m22:23:49.735717 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.test
[0m22:23:49.761749 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.test"
[0m22:23:49.764215 [debug] [Thread-1 (]: Began executing node model.dbt_prj.test
[0m22:23:49.830726 [debug] [Thread-1 (]: Creating new relation test
[0m22:23:49.864846 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.test"
[0m22:23:49.867303 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */


  create view `default`.`test` 
  
    
    
  as (
    SELECT 1
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:23:49.880982 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:23:49.965289 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c11bb5a-137d-4775-a163-357e72395977', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770b2843a0>]}
[0m22:23:49.968509 [info ] [Thread-1 (]: 1 of 1 OK created sql view model `default`.`test` .............................. [[32mOK[0m in 0.23s]
[0m22:23:49.974478 [debug] [Thread-1 (]: Finished running node model.dbt_prj.test
[0m22:23:49.980879 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:23:49.984247 [debug] [MainThread]: Connection 'model.dbt_prj.test' was left open.
[0m22:23:49.986490 [debug] [MainThread]: On model.dbt_prj.test: Close
[0m22:23:49.989836 [info ] [MainThread]: 
[0m22:23:49.992086 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.17 seconds (1.17s).
[0m22:23:49.998652 [debug] [MainThread]: Command end result
[0m22:23:50.175042 [info ] [MainThread]: 
[0m22:23:50.180819 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:23:50.184450 [info ] [MainThread]: 
[0m22:23:50.187037 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:23:50.193761 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3244276, "process_in_blocks": "0", "process_kernel_time": 0.300655, "process_mem_max_rss": "133036", "process_out_blocks": "3000", "process_user_time": 8.338191}
[0m22:23:50.201286 [debug] [MainThread]: Command `dbt run` succeeded at 22:23:50.196483 after 4.33 seconds
[0m22:23:50.203721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770dbc3c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770bc36710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f770bdecd60>]}
[0m22:23:50.205426 [debug] [MainThread]: Flushing usage events
[0m22:23:50.843679 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:24:30.001310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bce6fbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bb3bae30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bb3bbe80>]}


============================== 22:24:30.013153 | 82d1f7c9-2948-4430-8ab2-409d631ce63e ==============================
[0m22:24:30.013153 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:24:30.015859 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models test', 'send_anonymous_usage_stats': 'True'}
[0m22:24:30.664332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '82d1f7c9-2948-4430-8ab2-409d631ce63e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bcd99540>]}
[0m22:24:30.897204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '82d1f7c9-2948-4430-8ab2-409d631ce63e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bb3ba920>]}
[0m22:24:30.899627 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:24:31.139003 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:24:31.460818 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:24:31.462583 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/test.sql
[0m22:24:32.193595 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:24:32.213097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '82d1f7c9-2948-4430-8ab2-409d631ce63e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bae8c070>]}
[0m22:24:32.551848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '82d1f7c9-2948-4430-8ab2-409d631ce63e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9ba4b91e0>]}
[0m22:24:32.554113 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:24:32.556677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '82d1f7c9-2948-4430-8ab2-409d631ce63e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9ba4b9240>]}
[0m22:24:32.566573 [info ] [MainThread]: 
[0m22:24:32.569649 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:24:32.575155 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:24:32.620865 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:24:33.236505 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:24:33.245900 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:24:33.471763 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:24:33.509397 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:24:33.534044 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:24:33.544716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '82d1f7c9-2948-4430-8ab2-409d631ce63e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9ba4b9990>]}
[0m22:24:33.546885 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:24:33.548500 [info ] [MainThread]: 
[0m22:24:33.558133 [debug] [Thread-1 (]: Began running node model.dbt_prj.test
[0m22:24:33.561554 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`test` ................................... [RUN]
[0m22:24:33.567010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.test)
[0m22:24:33.569340 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.test
[0m22:24:33.598758 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.test"
[0m22:24:33.600738 [debug] [Thread-1 (]: Began executing node model.dbt_prj.test
[0m22:24:33.723906 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.test"
[0m22:24:33.726232 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */


  create view `default`.`test__dbt_tmp` 
  
    
    
  as (
    SELECT * FROM ECB_table
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:24:33.739687 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:24:33.766498 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */

    drop table if exists `default`.`test__dbt_backup` 
  
  ...
[0m22:24:33.773445 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:24:33.777358 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */

    rename table `default`.`test` to `default`.`test__dbt_backup` 
  
  ...
[0m22:24:33.784838 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:24:33.795927 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */

    drop table if exists `default`.`test` 
  
  ...
[0m22:24:33.802733 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:24:33.806499 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */

    rename table `default`.`test__dbt_tmp` to `default`.`test` 
  
  ...
[0m22:24:33.815105 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:24:33.900658 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.test: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.test"} */

    drop table if exists `default`.`test__dbt_backup` 
  ...
[0m22:24:33.908513 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:24:33.920215 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '82d1f7c9-2948-4430-8ab2-409d631ce63e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9ba4b9990>]}
[0m22:24:33.922443 [info ] [Thread-1 (]: 1 of 1 OK created sql view model `default`.`test` .............................. [[32mOK[0m in 0.35s]
[0m22:24:33.925522 [debug] [Thread-1 (]: Finished running node model.dbt_prj.test
[0m22:24:33.931032 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:24:33.932232 [debug] [MainThread]: Connection 'model.dbt_prj.test' was left open.
[0m22:24:33.933177 [debug] [MainThread]: On model.dbt_prj.test: Close
[0m22:24:33.934538 [info ] [MainThread]: 
[0m22:24:33.936611 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.37 seconds (1.37s).
[0m22:24:33.939605 [debug] [MainThread]: Command end result
[0m22:24:34.041033 [info ] [MainThread]: 
[0m22:24:34.043705 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:24:34.045833 [info ] [MainThread]: 
[0m22:24:34.047261 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:24:34.049924 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.2243676, "process_in_blocks": "0", "process_kernel_time": 0.370663, "process_mem_max_rss": "133004", "process_out_blocks": "2992", "process_user_time": 7.964254}
[0m22:24:34.051302 [debug] [MainThread]: Command `dbt run` succeeded at 22:24:34.050988 after 4.23 seconds
[0m22:24:34.052440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bce6fbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bccd2ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bb3ba920>]}
[0m22:24:34.053580 [debug] [MainThread]: Flushing usage events
[0m22:24:36.397973 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:34:02.642010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf13a7fbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf13daee30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf13dafe80>]}


============================== 22:34:02.649310 | 3c87eed8-b5e5-47a5-be56-152d1a751c7f ==============================
[0m22:34:02.649310 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:34:02.652351 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models average_exchange_rate_weekly', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:34:03.157733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3c87eed8-b5e5-47a5-be56-152d1a751c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf139a9570>]}
[0m22:34:03.366781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3c87eed8-b5e5-47a5-be56-152d1a751c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf13dae920>]}
[0m22:34:03.369197 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:34:03.614357 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:34:03.931232 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:34:03.933122 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_weekly.sql
[0m22:34:04.891405 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:34:04.909077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3c87eed8-b5e5-47a5-be56-152d1a751c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf110d8070>]}
[0m22:34:05.368587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3c87eed8-b5e5-47a5-be56-152d1a751c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf110a11e0>]}
[0m22:34:05.377109 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:34:05.379679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c87eed8-b5e5-47a5-be56-152d1a751c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf110a1240>]}
[0m22:34:05.394608 [info ] [MainThread]: 
[0m22:34:05.399030 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:34:05.429503 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:34:05.500151 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:34:06.101702 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:34:06.111677 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:34:06.328091 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:34:06.363294 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:34:06.385336 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:34:06.393009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c87eed8-b5e5-47a5-be56-152d1a751c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf110a0bb0>]}
[0m22:34:06.395571 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:34:06.397716 [info ] [MainThread]: 
[0m22:34:06.407487 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:06.409722 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:34:06.412838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:34:06.414318 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:06.442374 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:34:06.444363 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:06.518708 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_weekly
[0m22:34:06.588931 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:34:06.593283 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data;
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:34:06.606033 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data;
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:34:06.614980 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 693 (end of query) (line 24, col 14): ;
      
    )
        
        
                      -- end_of_sql
                      
                      . Expected one of: token sequence, Dot, token, OpeningRoundBracket, UUID, alias, AS, identifier, FINAL, SAMPLE, table, table function, subquery or list of joined tables, array join, LEFT ARRAY JOIN, INNER, ARRAY JOIN, GLOBAL, LOCAL, ANY, ALL, ASOF, SEMI, ANTI, ONLY, LEFT, RIGHT, FULL, CROSS, PASTE, JOIN, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::createDeprecated(String const&, int, bool) @ 0x000000000d7b708d
  2. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x00000000140dd332
  3. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d44a1
  4. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  5. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  6. DB::TCPHandler::run() @ 0x00000000136cc378
  7. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  8. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  9. Poco::PooledThread::run() @ 0x00000000165d3ddc
  10. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  11. ? @ 0x00007f41c6b52ac3
  12. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:34:06.623242 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c87eed8-b5e5-47a5-be56-152d1a751c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faefb1b2560>]}
[0m22:34:06.626898 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_weekly` .. [[31mERROR[0m in 0.21s]
[0m22:34:06.631762 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:06.642744 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:34:06.644606 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:34:06.646592 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:34:06.648784 [info ] [MainThread]: 
[0m22:34:06.652612 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.25 seconds (1.25s).
[0m22:34:06.657119 [debug] [MainThread]: Command end result
[0m22:34:06.808052 [info ] [MainThread]: 
[0m22:34:06.810412 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:34:06.813321 [info ] [MainThread]: 
[0m22:34:06.815904 [error] [MainThread]:   Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 693 (end of query) (line 24, col 14): ;
      
    )
        
        
                      -- end_of_sql
                      
                      . Expected one of: token sequence, Dot, token, OpeningRoundBracket, UUID, alias, AS, identifier, FINAL, SAMPLE, table, table function, subquery or list of joined tables, array join, LEFT ARRAY JOIN, INNER, ARRAY JOIN, GLOBAL, LOCAL, ANY, ALL, ASOF, SEMI, ANTI, ONLY, LEFT, RIGHT, FULL, CROSS, PASTE, JOIN, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::createDeprecated(String const&, int, bool) @ 0x000000000d7b708d
  2. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x00000000140dd332
  3. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d44a1
  4. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  5. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  6. DB::TCPHandler::run() @ 0x00000000136cc378
  7. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  8. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  9. Poco::PooledThread::run() @ 0x00000000165d3ddc
  10. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  11. ? @ 0x00007f41c6b52ac3
  12. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:34:06.820218 [info ] [MainThread]: 
[0m22:34:06.822870 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:34:06.827195 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.405745, "process_in_blocks": "0", "process_kernel_time": 0.370494, "process_mem_max_rss": "132056", "process_out_blocks": "3008", "process_user_time": 8.070774}
[0m22:34:06.829811 [debug] [MainThread]: Command `dbt run` failed at 22:34:06.828740 after 4.41 seconds
[0m22:34:06.831933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf13a7fbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf11eb3280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf11eb1e10>]}
[0m22:34:06.835463 [debug] [MainThread]: Flushing usage events
[0m22:34:07.673155 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:34:41.404575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67b126fbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af7bee60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af7bffa0>]}


============================== 22:34:41.412736 | b77beda3-45d5-4539-a0ca-717165afd209 ==============================
[0m22:34:41.412736 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:34:41.414571 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --models average_exchange_rate_weekly', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:34:41.935573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b77beda3-45d5-4539-a0ca-717165afd209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af8590c0>]}
[0m22:34:42.200529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b77beda3-45d5-4539-a0ca-717165afd209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af836ef0>]}
[0m22:34:42.202988 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:34:42.500809 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:34:42.817271 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:34:42.819063 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_weekly.sql
[0m22:34:43.566723 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:34:43.588297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b77beda3-45d5-4539-a0ca-717165afd209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af37d150>]}
[0m22:34:43.842010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b77beda3-45d5-4539-a0ca-717165afd209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af26a890>]}
[0m22:34:43.843802 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:34:43.845198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b77beda3-45d5-4539-a0ca-717165afd209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af26a8c0>]}
[0m22:34:43.852107 [info ] [MainThread]: 
[0m22:34:43.854190 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:34:43.857414 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:34:43.894747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:34:44.548549 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:34:44.576618 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:34:44.861570 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:34:44.879195 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:34:44.901792 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:34:44.908265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b77beda3-45d5-4539-a0ca-717165afd209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67af26b7c0>]}
[0m22:34:44.910514 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:34:44.912026 [info ] [MainThread]: 
[0m22:34:44.922811 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:44.924665 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:34:44.926387 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:34:44.927886 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:44.963302 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:34:44.966437 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:45.070017 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_weekly
[0m22:34:45.130234 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:34:45.133933 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:34:45.161532 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:34:45.172486 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:34:45.182651 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b77beda3-45d5-4539-a0ca-717165afd209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67acc76fb0>]}
[0m22:34:45.185920 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_weekly` .. [[31mERROR[0m in 0.25s]
[0m22:34:45.192746 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:34:45.206203 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:34:45.209500 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:34:45.214045 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:34:45.217003 [info ] [MainThread]: 
[0m22:34:45.219448 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.36 seconds (1.36s).
[0m22:34:45.224065 [debug] [MainThread]: Command end result
[0m22:34:45.472743 [info ] [MainThread]: 
[0m22:34:45.474358 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:34:45.476245 [info ] [MainThread]: 
[0m22:34:45.478002 [error] [MainThread]:   Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:34:45.483790 [info ] [MainThread]: 
[0m22:34:45.485908 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:34:45.489274 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.2451434, "process_in_blocks": "0", "process_kernel_time": 0.469889, "process_mem_max_rss": "135396", "process_out_blocks": "3016", "process_user_time": 7.978122}
[0m22:34:45.492178 [debug] [MainThread]: Command `dbt run` failed at 22:34:45.491022 after 4.25 seconds
[0m22:34:45.496772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67b126fbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67afbc4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67afbc55a0>]}
[0m22:34:45.500457 [debug] [MainThread]: Flushing usage events
[0m22:34:46.236146 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:36:00.109624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3607c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1a42fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1a42f50>]}


============================== 22:36:00.118308 | 08ac72c9-1734-4330-86b4-20a25b9cdab4 ==============================
[0m22:36:00.118308 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:36:00.120028 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --models average_exchange_rate_weekly', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:36:00.826429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08ac72c9-1734-4330-86b4-20a25b9cdab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1b11870>]}
[0m22:36:01.061107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08ac72c9-1734-4330-86b4-20a25b9cdab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1ae5720>]}
[0m22:36:01.063528 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:36:01.348872 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:36:01.684740 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:36:01.685556 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:36:01.701239 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:36:01.767560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '08ac72c9-1734-4330-86b4-20a25b9cdab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1725f00>]}
[0m22:36:01.958559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '08ac72c9-1734-4330-86b4-20a25b9cdab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1718f70>]}
[0m22:36:01.960869 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:36:01.962533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08ac72c9-1734-4330-86b4-20a25b9cdab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1719000>]}
[0m22:36:01.967301 [info ] [MainThread]: 
[0m22:36:01.968563 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:36:01.970128 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:36:02.009347 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:36:02.310002 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:36:02.321599 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:36:02.411940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:36:02.432926 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:36:02.455362 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:36:02.462054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08ac72c9-1734-4330-86b4-20a25b9cdab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1ae5c90>]}
[0m22:36:02.464153 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:36:02.465519 [info ] [MainThread]: 
[0m22:36:02.476913 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:02.478840 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:36:02.480644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:36:02.481892 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:02.517198 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:36:02.519037 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:02.596270 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_weekly
[0m22:36:02.630627 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:36:02.632988 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:36:02.643148 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:36:02.650491 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:36:02.656434 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08ac72c9-1734-4330-86b4-20a25b9cdab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e00c1240>]}
[0m22:36:02.658728 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_weekly` .. [[31mERROR[0m in 0.17s]
[0m22:36:02.662213 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:02.669887 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:36:02.671150 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:36:02.673256 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:36:02.675691 [info ] [MainThread]: 
[0m22:36:02.677037 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m22:36:02.681429 [debug] [MainThread]: Command end result
[0m22:36:02.925024 [info ] [MainThread]: 
[0m22:36:02.926847 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:36:02.929111 [info ] [MainThread]: 
[0m22:36:02.931514 [error] [MainThread]:   Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:36:02.933752 [info ] [MainThread]: 
[0m22:36:02.935458 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:36:02.937923 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.01289, "process_in_blocks": "0", "process_kernel_time": 0.369003, "process_mem_max_rss": "130428", "process_out_blocks": "2048", "process_user_time": 6.881407}
[0m22:36:02.939849 [debug] [MainThread]: Command `dbt run` failed at 22:36:02.939360 after 3.01 seconds
[0m22:36:02.941284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3607c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e32889a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e1629f00>]}
[0m22:36:02.944178 [debug] [MainThread]: Flushing usage events
[0m22:36:03.855074 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:36:28.614186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a3493af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a1a08460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a1a0ba00>]}


============================== 22:36:28.626609 | 7667b95e-bb1b-4457-96de-5687fb60c69b ==============================
[0m22:36:28.626609 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:36:28.634422 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models average_exchange_rate_weekly', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:36:29.158282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7667b95e-bb1b-4457-96de-5687fb60c69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a2ea0520>]}
[0m22:36:29.236413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7667b95e-bb1b-4457-96de-5687fb60c69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a1a37e80>]}
[0m22:36:29.237568 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:36:29.377189 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:36:29.680346 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:36:29.683197 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:36:29.728630 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:36:29.849405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7667b95e-bb1b-4457-96de-5687fb60c69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a1555de0>]}
[0m22:36:30.170866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7667b95e-bb1b-4457-96de-5687fb60c69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a150f460>]}
[0m22:36:30.173647 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:36:30.176106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7667b95e-bb1b-4457-96de-5687fb60c69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a150f790>]}
[0m22:36:30.182883 [info ] [MainThread]: 
[0m22:36:30.185858 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:36:30.189398 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:36:30.231559 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:36:31.003201 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:36:31.013525 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:36:31.105575 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:36:31.126136 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:36:31.153855 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:36:31.160770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7667b95e-bb1b-4457-96de-5687fb60c69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a1975db0>]}
[0m22:36:31.163327 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:36:31.165196 [info ] [MainThread]: 
[0m22:36:31.180028 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:31.183080 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:36:31.189582 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:36:31.192041 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:31.224058 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:36:31.225918 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:31.293517 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_weekly
[0m22:36:31.332733 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:36:31.334834 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:36:31.344556 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:36:31.351609 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:36:31.356855 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7667b95e-bb1b-4457-96de-5687fb60c69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a260cfd0>]}
[0m22:36:31.359191 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_weekly` .. [[31mERROR[0m in 0.17s]
[0m22:36:31.362886 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:31.372216 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:36:31.373681 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:36:31.375100 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:36:31.377765 [info ] [MainThread]: 
[0m22:36:31.381829 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.19 seconds (1.19s).
[0m22:36:31.386829 [debug] [MainThread]: Command end result
[0m22:36:31.654695 [info ] [MainThread]: 
[0m22:36:31.656589 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:36:31.660351 [info ] [MainThread]: 
[0m22:36:31.664217 [error] [MainThread]:   Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:36:31.668152 [info ] [MainThread]: 
[0m22:36:31.670383 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:36:31.673848 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.3595994, "process_in_blocks": "0", "process_kernel_time": 0.381743, "process_mem_max_rss": "129264", "process_out_blocks": "2040", "process_user_time": 7.313401}
[0m22:36:31.677352 [debug] [MainThread]: Command `dbt run` failed at 22:36:31.675989 after 3.36 seconds
[0m22:36:31.679511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a3493af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a354e3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f12a1547280>]}
[0m22:36:31.681611 [debug] [MainThread]: Flushing usage events
[0m22:36:32.383467 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:36:41.717307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbff67b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbf990a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbe4afe20>]}


============================== 22:36:41.725492 | aa2a54d3-522e-4d30-a4f7-38f474931254 ==============================
[0m22:36:41.725492 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:36:41.733255 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models average_exchange_rate_weekly', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:36:42.273074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aa2a54d3-522e-4d30-a4f7-38f474931254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbfe8d5a0>]}
[0m22:36:42.467148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aa2a54d3-522e-4d30-a4f7-38f474931254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbe4ae8c0>]}
[0m22:36:42.469955 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:36:42.789425 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:36:43.140359 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:36:43.142681 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:36:43.166204 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:36:43.244264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aa2a54d3-522e-4d30-a4f7-38f474931254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbe045e40>]}
[0m22:36:43.507721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aa2a54d3-522e-4d30-a4f7-38f474931254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbe2e11e0>]}
[0m22:36:43.509666 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:36:43.511199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa2a54d3-522e-4d30-a4f7-38f474931254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbfdd6680>]}
[0m22:36:43.515866 [info ] [MainThread]: 
[0m22:36:43.519247 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:36:43.522678 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:36:43.566234 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:36:44.164824 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:36:44.174461 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:36:44.269402 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:36:44.291999 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:36:44.314831 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:36:44.324626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa2a54d3-522e-4d30-a4f7-38f474931254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bc003fc70>]}
[0m22:36:44.326915 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:36:44.328571 [info ] [MainThread]: 
[0m22:36:44.336902 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:44.338850 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:36:44.340924 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:36:44.343331 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:44.376400 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:36:44.378391 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:44.462801 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_weekly
[0m22:36:44.505639 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:36:44.508021 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:36:44.519112 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(timestamp, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:36:44.526365 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:36:44.531529 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa2a54d3-522e-4d30-a4f7-38f474931254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbf0fcfd0>]}
[0m22:36:44.533853 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_weekly` .. [[31mERROR[0m in 0.19s]
[0m22:36:44.538184 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:36:44.544305 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:36:44.545572 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:36:44.546563 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:36:44.547531 [info ] [MainThread]: 
[0m22:36:44.549086 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m22:36:44.554951 [debug] [MainThread]: Command end result
[0m22:36:44.773416 [info ] [MainThread]: 
[0m22:36:44.775170 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:36:44.776607 [info ] [MainThread]: 
[0m22:36:44.778400 [error] [MainThread]:   Database Error in model average_exchange_rate_weekly (models/average_exchange_rate_weekly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `timestamp` in scope SELECT toStartOfWeek(timestamp, 1) AS start_of_week, CharCode AS from_currency, 'USD' AS to_currency, avg(Value) AS average_rate FROM default.ECB_table GROUP BY start_of_week, from_currency, to_currency. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f41c6b52ac3
  31. ? @ 0x00007f41c6be4850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_weekly.sql
[0m22:36:44.780329 [info ] [MainThread]: 
[0m22:36:44.781959 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:36:44.792466 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.252398, "process_in_blocks": "0", "process_kernel_time": 0.239279, "process_mem_max_rss": "129100", "process_out_blocks": "2040", "process_user_time": 7.337911}
[0m22:36:44.795748 [debug] [MainThread]: Command `dbt run` failed at 22:36:44.795137 after 3.26 seconds
[0m22:36:44.797797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbff67b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bbc1a3df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0bc003fc70>]}
[0m22:36:44.801188 [debug] [MainThread]: Flushing usage events
[0m22:36:45.717772 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:48:43.822977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001f923be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001fc4ee60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001fc4ffa0>]}


============================== 22:48:43.831085 | 3b4044d2-1664-4e09-a53a-aa8e4f4cd949 ==============================
[0m22:48:43.831085 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:48:43.833019 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models average_exchange_rate_weekly', 'send_anonymous_usage_stats': 'True'}
[0m22:48:44.352941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b4044d2-1664-4e09-a53a-aa8e4f4cd949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001dd590c0>]}
[0m22:48:44.592694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b4044d2-1664-4e09-a53a-aa8e4f4cd949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001fcc6ef0>]}
[0m22:48:44.595320 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:48:44.912132 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:48:45.262796 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:48:45.264680 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_weekly.sql
[0m22:48:46.066635 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:48:46.086137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b4044d2-1664-4e09-a53a-aa8e4f4cd949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001d8802e0>]}
[0m22:48:46.332847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b4044d2-1664-4e09-a53a-aa8e4f4cd949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001d166890>]}
[0m22:48:46.334577 [info ] [MainThread]: Found 3 models, 468 macros
[0m22:48:46.335817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b4044d2-1664-4e09-a53a-aa8e4f4cd949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001d1668c0>]}
[0m22:48:46.342904 [info ] [MainThread]: 
[0m22:48:46.345824 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:48:46.349255 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:48:46.386964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:48:47.071645 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:48:47.083833 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:48:47.319694 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:48:47.345025 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:48:47.377050 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:48:47.386227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b4044d2-1664-4e09-a53a-aa8e4f4cd949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001d1677c0>]}
[0m22:48:47.389265 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:48:47.391482 [info ] [MainThread]: 
[0m22:48:47.410485 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:48:47.414950 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:48:47.429924 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:48:47.432238 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:48:47.515630 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:48:47.518748 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:48:47.666422 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_weekly
[0m22:48:47.714768 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:48:47.717230 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(ExecutionTime, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:48:47.744508 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:48:47.885275 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b4044d2-1664-4e09-a53a-aa8e4f4cd949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00170c9c00>]}
[0m22:48:47.888603 [info ] [Thread-1 (]: 1 of 1 OK created sql view model `default`.`average_exchange_rate_weekly` ...... [[32mOK[0m in 0.45s]
[0m22:48:47.902039 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:48:47.908008 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:48:47.910117 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:48:47.916569 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:48:47.920674 [info ] [MainThread]: 
[0m22:48:47.923553 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.58 seconds (1.58s).
[0m22:48:47.942150 [debug] [MainThread]: Command end result
[0m22:48:48.054245 [info ] [MainThread]: 
[0m22:48:48.056307 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:48:48.058684 [info ] [MainThread]: 
[0m22:48:48.061741 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:48:48.064990 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.409136, "process_in_blocks": "0", "process_kernel_time": 0.330596, "process_mem_max_rss": "135392", "process_out_blocks": "2992", "process_user_time": 8.375102}
[0m22:48:48.066248 [debug] [MainThread]: Command `dbt run` succeeded at 22:48:48.065945 after 4.41 seconds
[0m22:48:48.067115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001f923be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001d989ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f001dd3c1f0>]}
[0m22:48:48.068225 [debug] [MainThread]: Flushing usage events
[0m22:48:49.183768 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:54:14.343086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f123b963a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1239ea3790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1239ea2560>]}


============================== 22:54:14.351132 | 0caa598f-0f4f-4acc-8131-170542d8dc0d ==============================
[0m22:54:14.351132 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:54:14.352774 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:54:14.953108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1239d36e00>]}
[0m22:54:15.141734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1239d34fd0>]}
[0m22:54:15.144305 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:54:15.412717 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:54:15.727797 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 1 files changed.
[0m22:54:15.729143 [debug] [MainThread]: Partial parsing: deleted file: dbt_prj://models/test.sql
[0m22:54:15.730594 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m22:54:16.491692 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:54:16.510225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1238f58130>]}
[0m22:54:16.751265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1238f479a0>]}
[0m22:54:16.752986 [info ] [MainThread]: Found 2 models, 468 macros
[0m22:54:16.754310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1238f47700>]}
[0m22:54:16.759043 [info ] [MainThread]: 
[0m22:54:16.761222 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:54:16.783521 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:54:16.817849 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:54:17.509867 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:54:17.519802 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:54:17.728309 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__default'
[0m22:54:17.763622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:54:18.247552 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:54:18.273793 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:54:18.280475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1238f97850>]}
[0m22:54:18.282521 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:54:18.284348 [info ] [MainThread]: 
[0m22:54:18.290390 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m22:54:18.292068 [info ] [Thread-1 (]: 1 of 2 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m22:54:18.293781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m22:54:18.295354 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m22:54:18.317331 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:54:18.318985 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m22:54:18.370379 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m22:54:18.396418 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:54:18.398016 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExchangeDate) AS month,
        from_currency,
        to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:54:18.406933 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExchangeDate) AS month,
        from_currency,
        to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:54:18.412668 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `ExchangeDate` in scope SELECT toStartOfMonth(ExchangeDate) AS month, from_currency, to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f10663a8ac3
  31. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:54:18.417442 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1239cdfb80>]}
[0m22:54:18.419528 [error] [Thread-1 (]: 1 of 2 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.12s]
[0m22:54:18.422613 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m22:54:18.424464 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m22:54:18.427749 [info ] [Thread-1 (]: 2 of 2 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m22:54:18.429403 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_prj.average_exchange_rate_monthly, now model.dbt_prj.average_exchange_rate_weekly)
[0m22:54:18.430581 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m22:54:18.436410 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:54:18.437799 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m22:54:18.481487 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m22:54:18.484212 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly__dbt_tmp` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(ExecutionTime, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:54:18.505621 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:54:18.537164 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    drop table if exists `default`.`average_exchange_rate_weekly__dbt_backup` 
  
  ...
[0m22:54:18.544815 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:54:18.549850 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    rename table `default`.`average_exchange_rate_weekly` to `default`.`average_exchange_rate_weekly__dbt_backup` 
  
  ...
[0m22:54:18.558002 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:54:18.569548 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    drop table if exists `default`.`average_exchange_rate_weekly` 
  
  ...
[0m22:54:18.577223 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:54:18.580960 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    rename table `default`.`average_exchange_rate_weekly__dbt_tmp` to `default`.`average_exchange_rate_weekly` 
  
  ...
[0m22:54:18.588081 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:54:18.671660 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    drop table if exists `default`.`average_exchange_rate_weekly__dbt_backup` 
  ...
[0m22:54:18.679830 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:54:18.691544 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0caa598f-0f4f-4acc-8131-170542d8dc0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f123b7f7bb0>]}
[0m22:54:18.694286 [info ] [Thread-1 (]: 2 of 2 OK created sql view model `default`.`average_exchange_rate_weekly` ...... [[32mOK[0m in 0.26s]
[0m22:54:18.697995 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m22:54:18.703341 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:54:18.704803 [debug] [MainThread]: Connection 'list_' was left open.
[0m22:54:18.705768 [debug] [MainThread]: On list_: Close
[0m22:54:18.706768 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m22:54:18.708748 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m22:54:18.710484 [info ] [MainThread]: 
[0m22:54:18.712872 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.95 seconds (1.95s).
[0m22:54:18.716473 [debug] [MainThread]: Command end result
[0m22:54:18.814546 [info ] [MainThread]: 
[0m22:54:18.817143 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:54:18.818566 [info ] [MainThread]: 
[0m22:54:18.820558 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `ExchangeDate` in scope SELECT toStartOfMonth(ExchangeDate) AS month, from_currency, to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f10663a8ac3
  31. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:54:18.822964 [info ] [MainThread]: 
[0m22:54:18.824729 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m22:54:18.828314 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.669857, "process_in_blocks": "0", "process_kernel_time": 0.417643, "process_mem_max_rss": "133264", "process_out_blocks": "3048", "process_user_time": 7.994894}
[0m22:54:18.830950 [debug] [MainThread]: Command `dbt run` failed at 22:54:18.830017 after 4.67 seconds
[0m22:54:18.832680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f123b963a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1238f47c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1238f47cd0>]}
[0m22:54:18.834340 [debug] [MainThread]: Flushing usage events
[0m22:54:19.556606 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:56:05.608511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed6987be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed6cbae60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed6cbbfa0>]}


============================== 22:56:05.618930 | 8ce8df86-db1e-4b23-bfa3-6d93e29a76d7 ==============================
[0m22:56:05.618930 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:56:05.622686 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:56:06.190479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ce8df86-db1e-4b23-bfa3-6d93e29a76d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed4dc10c0>]}
[0m22:56:06.373997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ce8df86-db1e-4b23-bfa3-6d93e29a76d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed6d32ef0>]}
[0m22:56:06.376457 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:56:06.615385 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:56:06.924592 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:56:06.926316 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:56:06.961853 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:56:07.071099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ce8df86-db1e-4b23-bfa3-6d93e29a76d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed4aa1a50>]}
[0m22:56:07.428338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ce8df86-db1e-4b23-bfa3-6d93e29a76d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed4aa23b0>]}
[0m22:56:07.430215 [info ] [MainThread]: Found 2 models, 468 macros
[0m22:56:07.432067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ce8df86-db1e-4b23-bfa3-6d93e29a76d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed4aa2200>]}
[0m22:56:07.438511 [info ] [MainThread]: 
[0m22:56:07.442029 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:56:07.447075 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:56:07.488504 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:56:08.358457 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:56:08.366483 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:56:08.439075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:56:08.459054 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:56:08.477120 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:56:08.482964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ce8df86-db1e-4b23-bfa3-6d93e29a76d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed6d31b40>]}
[0m22:56:08.484736 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:56:08.485983 [info ] [MainThread]: 
[0m22:56:08.491642 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m22:56:08.493233 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m22:56:08.494759 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m22:56:08.495884 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m22:56:08.515128 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:56:08.517399 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m22:56:08.598168 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m22:56:08.633862 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:56:08.636339 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExchangeDate) AS month,
        from_currency,
        to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:56:08.646360 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExchangeDate) AS month,
        from_currency,
        to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:56:08.653532 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `ExchangeDate` in scope SELECT toStartOfMonth(ExchangeDate) AS month, from_currency, to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f10663a8ac3
  31. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:56:08.659222 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ce8df86-db1e-4b23-bfa3-6d93e29a76d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed5b5cfd0>]}
[0m22:56:08.661217 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.16s]
[0m22:56:08.663479 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m22:56:08.669704 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:56:08.671078 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m22:56:08.672165 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m22:56:08.673495 [info ] [MainThread]: 
[0m22:56:08.675140 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m22:56:08.678304 [debug] [MainThread]: Command end result
[0m22:56:08.878165 [info ] [MainThread]: 
[0m22:56:08.880054 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:56:08.881505 [info ] [MainThread]: 
[0m22:56:08.883473 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `ExchangeDate` in scope SELECT toStartOfMonth(ExchangeDate) AS month, from_currency, to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  8. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  11. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  13. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  14. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  15. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  16. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  17. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  18. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  19. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  20. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  21. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  22. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  23. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  24. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  25. DB::TCPHandler::run() @ 0x00000000136cc378
  26. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  27. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  28. Poco::PooledThread::run() @ 0x00000000165d3ddc
  29. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  30. ? @ 0x00007f10663a8ac3
  31. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:56:08.886130 [info ] [MainThread]: 
[0m22:56:08.888796 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:56:08.892796 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.4982488, "process_in_blocks": "0", "process_kernel_time": 0.32061, "process_mem_max_rss": "129340", "process_out_blocks": "2040", "process_user_time": 7.15362}
[0m22:56:08.894619 [debug] [MainThread]: Command `dbt run` failed at 22:56:08.894061 after 3.50 seconds
[0m22:56:08.896924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed6987be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ece9bf490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ed48b03a0>]}
[0m22:56:08.898743 [debug] [MainThread]: Flushing usage events
[0m22:56:09.648713 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:58:03.581373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350e2dfbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350c882e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350c883fa0>]}


============================== 22:58:03.589495 | 64a3ce43-aa75-4146-a3fb-0285221d9b56 ==============================
[0m22:58:03.589495 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:58:03.591782 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:58:04.106589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64a3ce43-aa75-4146-a3fb-0285221d9b56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350c7190c0>]}
[0m22:58:04.295563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64a3ce43-aa75-4146-a3fb-0285221d9b56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350c8f6ef0>]}
[0m22:58:04.299787 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m22:58:04.563688 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:58:04.845714 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:58:04.847631 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m22:58:05.601109 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m22:58:05.626663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64a3ce43-aa75-4146-a3fb-0285221d9b56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350b93c130>]}
[0m22:58:05.976338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64a3ce43-aa75-4146-a3fb-0285221d9b56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350b90ab30>]}
[0m22:58:05.978295 [info ] [MainThread]: Found 2 models, 468 macros
[0m22:58:05.979736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64a3ce43-aa75-4146-a3fb-0285221d9b56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350b90afb0>]}
[0m22:58:05.986290 [info ] [MainThread]: 
[0m22:58:05.990726 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:58:05.993818 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:58:06.040587 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:58:06.670654 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:58:06.680863 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:58:06.874681 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m22:58:06.900156 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m22:58:06.919443 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:58:06.926434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64a3ce43-aa75-4146-a3fb-0285221d9b56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350b90beb0>]}
[0m22:58:06.928409 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:58:06.930140 [info ] [MainThread]: 
[0m22:58:06.941426 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m22:58:06.943389 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m22:58:06.945201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m22:58:06.946767 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m22:58:06.973749 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:58:06.975775 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m22:58:07.039837 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m22:58:07.072173 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m22:58:07.074433 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        from_currency,
        to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:58:07.085356 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        from_currency,
        to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m22:58:07.092634 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression identifier `from_currency` in scope SELECT toStartOfMonth(ExecutionTime) AS month, from_currency, to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  6. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  8. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  10. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  11. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  12. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  13. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  14. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  15. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  16. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  17. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  18. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  19. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  20. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  21. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  22. DB::TCPHandler::run() @ 0x00000000136cc378
  23. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  24. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  25. Poco::PooledThread::run() @ 0x00000000165d3ddc
  26. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  27. ? @ 0x00007f10663a8ac3
  28. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:58:07.098437 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a3ce43-aa75-4146-a3fb-0285221d9b56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3509b0eda0>]}
[0m22:58:07.100683 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.15s]
[0m22:58:07.106613 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m22:58:07.114855 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:58:07.116071 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m22:58:07.117357 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m22:58:07.118446 [info ] [MainThread]: 
[0m22:58:07.119734 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.13 seconds (1.13s).
[0m22:58:07.125543 [debug] [MainThread]: Command end result
[0m22:58:07.232215 [info ] [MainThread]: 
[0m22:58:07.234202 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:58:07.236851 [info ] [MainThread]: 
[0m22:58:07.240893 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression identifier `from_currency` in scope SELECT toStartOfMonth(ExecutionTime) AS month, from_currency, to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  6. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  8. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  9. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  10. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  11. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  12. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  13. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  14. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  15. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  16. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  17. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  18. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  19. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  20. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  21. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  22. DB::TCPHandler::run() @ 0x00000000136cc378
  23. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  24. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  25. Poco::PooledThread::run() @ 0x00000000165d3ddc
  26. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  27. ? @ 0x00007f10663a8ac3
  28. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m22:58:07.244169 [info ] [MainThread]: 
[0m22:58:07.247597 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:58:07.251941 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.906565, "process_in_blocks": "0", "process_kernel_time": 0.270152, "process_mem_max_rss": "133584", "process_out_blocks": "3016", "process_user_time": 7.334135}
[0m22:58:07.254243 [debug] [MainThread]: Command `dbt run` failed at 22:58:07.253688 after 3.91 seconds
[0m22:58:07.256424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350e2dfbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350c7c04c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350c7c13f0>]}
[0m22:58:07.258833 [debug] [MainThread]: Flushing usage events
[0m22:58:08.407274 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:02:09.024635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4fc463be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4faa06e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4faa07fa0>]}


============================== 23:02:09.036030 | 0a93d4df-edb2-430f-b611-7bf11f210237 ==============================
[0m23:02:09.036030 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:02:09.038040 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:02:09.752599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a93d4df-edb2-430f-b611-7bf11f210237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4fa8a4880>]}
[0m23:02:09.933452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a93d4df-edb2-430f-b611-7bf11f210237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4faa7aef0>]}
[0m23:02:09.936097 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:02:10.191939 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m23:02:10.479441 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:02:10.481507 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m23:02:11.369216 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m23:02:11.390670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a93d4df-edb2-430f-b611-7bf11f210237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4f9ae0130>]}
[0m23:02:11.860696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a93d4df-edb2-430f-b611-7bf11f210237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4f9aaab30>]}
[0m23:02:11.863314 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:02:11.865314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a93d4df-edb2-430f-b611-7bf11f210237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4f9aaafb0>]}
[0m23:02:11.872852 [info ] [MainThread]: 
[0m23:02:11.875959 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:02:11.880848 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:02:11.933027 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:02:12.443724 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:02:12.451818 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:02:12.652444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m23:02:12.672273 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m23:02:12.690815 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:02:12.697296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a93d4df-edb2-430f-b611-7bf11f210237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4f9aabeb0>]}
[0m23:02:12.699207 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:02:12.700952 [info ] [MainThread]: 
[0m23:02:12.707707 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m23:02:12.709466 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m23:02:12.711474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m23:02:12.713062 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m23:02:12.735977 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:02:12.737807 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m23:02:12.807736 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m23:02:12.840803 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:02:12.842926 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:02:12.853762 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m23:02:12.861161 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `rate` in scope WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, from_currency, to_currency, avg(rate) AS rate FROM raw_data GROUP BY month, from_currency, to_currency. Maybe you meant: ['rate']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::tryResolveIdentifierFromAliases(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176d24b
  8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176f18c
  9. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176fb06
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e4c0
  11. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  12. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  13. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  14. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  15. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  16. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  17. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  18. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  19. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  20. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  21. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  22. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  23. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  24. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  25. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  26. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  27. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  28. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  29. DB::TCPHandler::run() @ 0x00000000136cc378
  30. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  31. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:02:12.866551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a93d4df-edb2-430f-b611-7bf11f210237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4f81bae00>]}
[0m23:02:12.868914 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.15s]
[0m23:02:12.871704 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m23:02:12.878246 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:02:12.879373 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m23:02:12.880693 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m23:02:12.881804 [info ] [MainThread]: 
[0m23:02:12.883057 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.01 seconds (1.01s).
[0m23:02:12.886269 [debug] [MainThread]: Command end result
[0m23:02:12.992095 [info ] [MainThread]: 
[0m23:02:12.994640 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:02:12.997184 [info ] [MainThread]: 
[0m23:02:13.001553 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `rate` in scope WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, from_currency, to_currency, avg(rate) AS rate FROM raw_data GROUP BY month, from_currency, to_currency. Maybe you meant: ['rate']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x000000001178f12f
  3. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000011760a18
  4. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  5. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000011776b0d
  6. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e300
  7. DB::QueryAnalyzer::tryResolveIdentifierFromAliases(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176d24b
  8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176f18c
  9. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveSettings) @ 0x000000001176fb06
  10. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e4c0
  11. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x000000001175cde0
  12. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x000000001178fae7
  13. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001175323c
  14. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  15. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  16. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  17. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  18. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  19. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  20. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  21. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  22. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  23. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  24. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  25. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  26. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  27. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  28. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  29. DB::TCPHandler::run() @ 0x00000000136cc378
  30. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  31. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:02:13.004817 [info ] [MainThread]: 
[0m23:02:13.007270 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:02:13.013001 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.143552, "process_in_blocks": "0", "process_kernel_time": 0.219886, "process_mem_max_rss": "131932", "process_out_blocks": "3024", "process_user_time": 8.025853}
[0m23:02:13.015276 [debug] [MainThread]: Command `dbt run` failed at 23:02:13.014819 after 4.15 seconds
[0m23:02:13.018923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4fc463be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4fa9572e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4fa9577f0>]}
[0m23:02:13.021966 [debug] [MainThread]: Flushing usage events
[0m23:02:13.749787 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:07:29.081367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e3585bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33e42590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33e425f0>]}


============================== 23:07:29.089397 | 325c21f8-4cb1-4950-b26d-fef5ccde341e ==============================
[0m23:07:29.089397 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:07:29.091968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'send_anonymous_usage_stats': 'True'}
[0m23:07:29.685738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '325c21f8-4cb1-4950-b26d-fef5ccde341e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33d1d870>]}
[0m23:07:30.005865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '325c21f8-4cb1-4950-b26d-fef5ccde341e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33cfd720>]}
[0m23:07:30.009596 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:07:30.312603 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m23:07:30.563657 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:07:30.565497 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m23:07:31.403011 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m23:07:31.419917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '325c21f8-4cb1-4950-b26d-fef5ccde341e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e3387c130>]}
[0m23:07:31.772734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '325c21f8-4cb1-4950-b26d-fef5ccde341e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33852740>]}
[0m23:07:31.775351 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:07:31.777601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '325c21f8-4cb1-4950-b26d-fef5ccde341e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e338529e0>]}
[0m23:07:31.784414 [info ] [MainThread]: 
[0m23:07:31.787739 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:07:31.791808 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:07:31.836860 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:07:32.643118 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:07:32.651916 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:07:32.840870 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m23:07:32.872550 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m23:07:32.892847 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:07:32.900461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '325c21f8-4cb1-4950-b26d-fef5ccde341e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33853a00>]}
[0m23:07:32.902393 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:07:32.903795 [info ] [MainThread]: 
[0m23:07:32.913280 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m23:07:32.916579 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m23:07:32.918981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m23:07:32.920612 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m23:07:32.948047 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:07:32.950216 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m23:07:33.019339 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m23:07:33.056487 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:07:33.059078 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:07:33.071636 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    WHERE from_currency = 'EUR' AND to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month, from_currency, to_currency
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m23:07:33.078959 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column default.ECB_table.ExecutionTime is not under aggregate function and not in GROUP BY keys. In query SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  6. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  7. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2058
  8. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  10. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  11. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  12. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  13. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  14. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  15. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  16. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  17. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  18. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  19. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  20. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  21. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  22. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  23. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  24. DB::TCPHandler::run() @ 0x00000000136cc378
  25. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  26. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  27. Poco::PooledThread::run() @ 0x00000000165d3ddc
  28. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  29. ? @ 0x00007f10663a8ac3
  30. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:07:33.084182 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '325c21f8-4cb1-4950-b26d-fef5ccde341e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e31062e30>]}
[0m23:07:33.086636 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.16s]
[0m23:07:33.090114 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m23:07:33.096899 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:07:33.098324 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m23:07:33.099408 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m23:07:33.100528 [info ] [MainThread]: 
[0m23:07:33.101939 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.31 seconds (1.31s).
[0m23:07:33.105173 [debug] [MainThread]: Command end result
[0m23:07:33.214367 [info ] [MainThread]: 
[0m23:07:33.216268 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:07:33.217736 [info ] [MainThread]: 
[0m23:07:33.219929 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column default.ECB_table.ExecutionTime is not under aggregate function and not in GROUP BY keys. In query SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table WHERE (from_currency = 'EUR') AND (to_currency = 'USD'). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  6. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  7. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2058
  8. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x000000001175e1e3
  10. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x0000000011790502
  11. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x00000000117531d6
  12. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  13. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  14. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  15. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  16. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  17. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  18. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  19. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  20. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  21. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  22. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  23. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  24. DB::TCPHandler::run() @ 0x00000000136cc378
  25. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  26. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  27. Poco::PooledThread::run() @ 0x00000000165d3ddc
  28. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  29. ? @ 0x00007f10663a8ac3
  30. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:07:33.222571 [info ] [MainThread]: 
[0m23:07:33.225123 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:07:33.229854 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.301919, "process_in_blocks": "0", "process_kernel_time": 0.350788, "process_mem_max_rss": "133596", "process_out_blocks": "3024", "process_user_time": 8.268584}
[0m23:07:33.233246 [debug] [MainThread]: Command `dbt run` failed at 23:07:33.232675 after 4.31 seconds
[0m23:07:33.234728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e3585bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33cfd8a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e33cfcc70>]}
[0m23:07:33.236437 [debug] [MainThread]: Flushing usage events
[0m23:07:33.976486 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:10:48.752183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138fd8bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138f7eba60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138e2dfdf0>]}


============================== 23:10:48.772279 | 4e162d7f-28f5-4277-a5dd-980dc83123ea ==============================
[0m23:10:48.772279 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:10:48.775069 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:10:49.225175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4e162d7f-28f5-4277-a5dd-980dc83123ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138fcb95d0>]}
[0m23:10:49.314967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4e162d7f-28f5-4277-a5dd-980dc83123ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138e377a00>]}
[0m23:10:49.316296 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:10:49.446259 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m23:10:49.717118 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:10:49.719017 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m23:10:50.583029 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m23:10:50.607610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e162d7f-28f5-4277-a5dd-980dc83123ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138ddac130>]}
[0m23:10:50.916644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e162d7f-28f5-4277-a5dd-980dc83123ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138dd9fd90>]}
[0m23:10:50.920064 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:10:50.922433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e162d7f-28f5-4277-a5dd-980dc83123ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138dd9fb50>]}
[0m23:10:50.935876 [info ] [MainThread]: 
[0m23:10:50.938558 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:10:50.944268 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:10:51.007248 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:10:51.696662 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:10:51.706182 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:10:51.916677 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m23:10:51.939092 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m23:10:51.957812 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:10:51.966615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e162d7f-28f5-4277-a5dd-980dc83123ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138dd9f4c0>]}
[0m23:10:51.978537 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:10:51.980508 [info ] [MainThread]: 
[0m23:10:52.013976 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m23:10:52.016981 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m23:10:52.030977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m23:10:52.033015 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m23:10:52.099853 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:10:52.102560 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m23:10:52.185740 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m23:10:52.222628 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:10:52.224514 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
order by month
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:10:52.236289 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
order by month
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m23:10:52.243116 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column raw_data.month is not under aggregate function and not in GROUP BY keys. In query WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table GROUP BY month HAVING (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, from_currency, to_currency, avg(rate) AS rate FROM raw_data ORDER BY month ASC. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  6. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2027
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  8. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  9. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  10. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  11. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  12. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  13. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  14. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  15. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  16. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  17. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  18. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  19. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  20. DB::TCPHandler::run() @ 0x00000000136cc378
  21. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  22. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  23. Poco::PooledThread::run() @ 0x00000000165d3ddc
  24. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  25. ? @ 0x00007f10663a8ac3
  26. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:10:52.247300 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e162d7f-28f5-4277-a5dd-980dc83123ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1377566e00>]}
[0m23:10:52.249311 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.23s]
[0m23:10:52.251860 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m23:10:52.260013 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:10:52.261656 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m23:10:52.262859 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m23:10:52.264320 [info ] [MainThread]: 
[0m23:10:52.265584 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.33 seconds (1.33s).
[0m23:10:52.268043 [debug] [MainThread]: Command end result
[0m23:10:52.354449 [info ] [MainThread]: 
[0m23:10:52.356304 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:10:52.358445 [info ] [MainThread]: 
[0m23:10:52.361909 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column raw_data.month is not under aggregate function and not in GROUP BY keys. In query WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table GROUP BY month HAVING (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, from_currency, to_currency, avg(rate) AS rate FROM raw_data ORDER BY month ASC. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  6. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2027
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  8. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  9. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  10. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  11. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  12. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  13. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  14. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  15. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  16. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  17. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  18. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  19. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  20. DB::TCPHandler::run() @ 0x00000000136cc378
  21. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  22. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  23. Poco::PooledThread::run() @ 0x00000000165d3ddc
  24. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  25. ? @ 0x00007f10663a8ac3
  26. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:10:52.364113 [info ] [MainThread]: 
[0m23:10:52.365805 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:10:52.369233 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.9254932, "process_in_blocks": "0", "process_kernel_time": 0.379404, "process_mem_max_rss": "132076", "process_out_blocks": "3016", "process_user_time": 7.458292}
[0m23:10:52.371033 [debug] [MainThread]: Command `dbt run` failed at 23:10:52.370606 after 3.93 seconds
[0m23:10:52.372972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138fd8bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138e222fe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f138e222da0>]}
[0m23:10:52.375741 [debug] [MainThread]: Flushing usage events
[0m23:10:53.023321 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:13:05.470234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2103bfbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20e952e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20e953e80>]}


============================== 23:13:05.477110 | aa8cac0b-d819-4477-82f1-f30072c42f68 ==============================
[0m23:13:05.477110 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:13:05.479733 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:13:06.036455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aa8cac0b-d819-4477-82f1-f30072c42f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2102e9570>]}
[0m23:13:06.250720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aa8cac0b-d819-4477-82f1-f30072c42f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20e952920>]}
[0m23:13:06.252900 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:13:06.528171 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m23:13:06.785911 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:13:06.787375 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m23:13:07.649668 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m23:13:07.667289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aa8cac0b-d819-4477-82f1-f30072c42f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20da14130>]}
[0m23:13:07.858491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aa8cac0b-d819-4477-82f1-f30072c42f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20d9da0e0>]}
[0m23:13:07.860040 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:13:07.861086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa8cac0b-d819-4477-82f1-f30072c42f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20d9db760>]}
[0m23:13:07.868147 [info ] [MainThread]: 
[0m23:13:07.870281 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:13:07.873132 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:13:07.903018 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:13:08.455767 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:13:08.465834 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:13:08.691341 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m23:13:08.714762 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m23:13:08.738920 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:13:08.748267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa8cac0b-d819-4477-82f1-f30072c42f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20d9d9120>]}
[0m23:13:08.752304 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:13:08.754382 [info ] [MainThread]: 
[0m23:13:08.787556 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m23:13:08.791440 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m23:13:08.795185 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m23:13:08.799109 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m23:13:08.852787 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:13:08.856563 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m23:13:08.981544 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m23:13:09.053493 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:13:09.059710 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:13:09.075412 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        'EUR' as from_currency,
        'USD' to_currency,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    from_currency,
    to_currency,
    AVG(rate) AS rate
FROM raw_data
GROUP BY month
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m23:13:09.085220 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column raw_data.from_currency is not under aggregate function and not in GROUP BY keys. In query WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table GROUP BY month HAVING (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, from_currency, to_currency, avg(rate) AS rate FROM raw_data GROUP BY month. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2058
  6. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  7. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  8. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  9. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  10. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  11. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  12. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  13. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  14. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  15. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  16. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  17. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  18. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  19. DB::TCPHandler::run() @ 0x00000000136cc378
  20. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  21. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  22. Poco::PooledThread::run() @ 0x00000000165d3ddc
  23. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  24. ? @ 0x00007f10663a8ac3
  25. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:13:09.093911 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8cac0b-d819-4477-82f1-f30072c42f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20c0e6dd0>]}
[0m23:13:09.097500 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.29s]
[0m23:13:09.110497 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m23:13:09.121157 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:13:09.122558 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m23:13:09.124424 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m23:13:09.126484 [info ] [MainThread]: 
[0m23:13:09.128911 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.26 seconds (1.26s).
[0m23:13:09.140826 [debug] [MainThread]: Command end result
[0m23:13:09.319929 [info ] [MainThread]: 
[0m23:13:09.321828 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:13:09.325270 [info ] [MainThread]: 
[0m23:13:09.330003 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column raw_data.from_currency is not under aggregate function and not in GROUP BY keys. In query WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, 'EUR' AS from_currency, 'USD' AS to_currency, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table GROUP BY month HAVING (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, from_currency, to_currency, avg(rate) AS rate FROM raw_data GROUP BY month. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2058
  6. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  7. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  8. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  9. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  10. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  11. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  12. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  13. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  14. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  15. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  16. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  17. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  18. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  19. DB::TCPHandler::run() @ 0x00000000136cc378
  20. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  21. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  22. Poco::PooledThread::run() @ 0x00000000165d3ddc
  23. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  24. ? @ 0x00007f10663a8ac3
  25. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:13:09.332462 [info ] [MainThread]: 
[0m23:13:09.334299 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:13:09.338574 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.027895, "process_in_blocks": "0", "process_kernel_time": 0.368121, "process_mem_max_rss": "132040", "process_out_blocks": "3016", "process_user_time": 7.790252}
[0m23:13:09.339778 [debug] [MainThread]: Command `dbt run` failed at 23:13:09.339520 after 4.03 seconds
[0m23:13:09.340707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2103bfbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20e8978b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc20e894880>]}
[0m23:13:09.341830 [debug] [MainThread]: Flushing usage events
[0m23:13:09.967659 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:15:02.924926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b7cabb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b623ee30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b623ef80>]}


============================== 23:15:02.934042 | 2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c ==============================
[0m23:15:02.934042 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:15:02.936800 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:15:03.446993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b62b5e70>]}
[0m23:15:03.643748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b6e92f50>]}
[0m23:15:03.646172 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:15:03.942609 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m23:15:04.344306 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:15:04.347532 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m23:15:05.194249 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m23:15:05.214854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b5500130>]}
[0m23:15:05.470597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b54dacb0>]}
[0m23:15:05.472405 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:15:05.474083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b54da050>]}
[0m23:15:05.482429 [info ] [MainThread]: 
[0m23:15:05.485794 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:15:05.489700 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:15:05.527663 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:15:06.148451 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:15:06.163147 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:15:06.393607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m23:15:06.415577 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m23:15:06.445038 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:15:06.455077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b54d8f10>]}
[0m23:15:06.457648 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:15:06.459565 [info ] [MainThread]: 
[0m23:15:06.475546 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m23:15:06.479911 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m23:15:06.484084 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m23:15:06.487726 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m23:15:06.518612 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:15:06.520548 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m23:15:06.621313 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m23:15:06.673759 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:15:06.678591 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    'EUR' as from_currency,
    'USD' as to_currency,
    rate
FROM raw_data
GROUP BY month
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:15:06.703816 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    'EUR' as from_currency,
    'USD' as to_currency,
    rate
FROM raw_data
GROUP BY month
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m23:15:06.719026 [debug] [Thread-1 (]: Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column raw_data.rate is not under aggregate function and not in GROUP BY keys. In query WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table GROUP BY month HAVING (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, 'EUR' AS from_currency, 'USD' AS to_currency, rate FROM raw_data GROUP BY month. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2058
  6. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  7. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  8. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  9. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  10. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  11. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  12. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  13. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  14. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  15. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  16. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  17. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  18. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  19. DB::TCPHandler::run() @ 0x00000000136cc378
  20. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  21. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  22. Poco::PooledThread::run() @ 0x00000000165d3ddc
  23. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  24. ? @ 0x00007f10663a8ac3
  25. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:15:06.736476 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2bbe6bf4-2787-4f5a-86cb-3df736fd0d0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b40d2da0>]}
[0m23:15:06.744788 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model `default`.`average_exchange_rate_monthly` . [[31mERROR[0m in 0.24s]
[0m23:15:06.749128 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m23:15:06.762034 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:15:06.764448 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m23:15:06.766106 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m23:15:06.768573 [info ] [MainThread]: 
[0m23:15:06.770539 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.28 seconds (1.28s).
[0m23:15:06.774546 [debug] [MainThread]: Command end result
[0m23:15:06.902764 [info ] [MainThread]: 
[0m23:15:06.904513 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:15:06.907131 [info ] [MainThread]: 
[0m23:15:06.910408 [error] [MainThread]:   Database Error in model average_exchange_rate_monthly (models/average_exchange_rate_monthly.sql)
  Code: 215.
  DB::Exception: Column raw_data.rate is not under aggregate function and not in GROUP BY keys. In query WITH raw_data AS (SELECT toStartOfMonth(ExecutionTime) AS month, avg(EUR_to_X / USD_to_X) AS rate FROM default.ECB_table GROUP BY month HAVING (from_currency = 'EUR') AND (to_currency = 'USD')) SELECT month, 'EUR' AS from_currency, 'USD' AS to_currency, rate FROM raw_data GROUP BY month. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000d74955b
  1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000863c82c
  2. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000863e66b
  3. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2e21
  4. DB::InDepthQueryTreeVisitor<DB::(anonymous namespace)::ValidateGroupByColumnsVisitor, true>::visit(std::shared_ptr<DB::IQueryTreeNode> const&) @ 0x00000000117c2b1f
  5. DB::validateAggregates(std::shared_ptr<DB::IQueryTreeNode> const&, DB::AggregatesValidationParams) @ 0x00000000117c2058
  6. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000011755ff0
  7. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001175160c
  8. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000011750ee0
  9. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x0000000011e00156
  10. DB::(anonymous namespace)::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.235539909016221768) @ 0x000000001205c7bd
  11. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x000000001205a71c
  12. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x000000001205d359
  13. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x0000000011dbf60d
  14. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x0000000011dc8b80
  15. DB::InterpreterCreateQuery::execute() @ 0x0000000011ddbad8
  16. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x00000000123d8875
  17. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000123d367d
  18. DB::TCPHandler::runImpl() @ 0x00000000136b10fe
  19. DB::TCPHandler::run() @ 0x00000000136cc378
  20. Poco::Net::TCPServerConnection::start() @ 0x0000000016607027
  21. Poco::Net::TCPServerDispatcher::run() @ 0x00000000166074b9
  22. Poco::PooledThread::run() @ 0x00000000165d3ddc
  23. Poco::ThreadImpl::runnableEntry(void*) @ 0x00000000165d237d
  24. ? @ 0x00007f10663a8ac3
  25. ? @ 0x00007f106643a850
  compiled code at target/run/dbt_prj/models/average_exchange_rate_monthly.sql
[0m23:15:06.913693 [info ] [MainThread]: 
[0m23:15:06.915764 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:15:06.920387 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.3067145, "process_in_blocks": "0", "process_kernel_time": 0.378909, "process_mem_max_rss": "133496", "process_out_blocks": "3016", "process_user_time": 8.545407}
[0m23:15:06.921993 [debug] [MainThread]: Command `dbt run` failed at 23:15:06.921625 after 4.31 seconds
[0m23:15:06.923705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b7cabb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b61896f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b618a7a0>]}
[0m23:15:06.927539 [debug] [MainThread]: Flushing usage events
[0m23:15:07.533175 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:17:08.995870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a18affbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a1709ee60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a1709ffa0>]}


============================== 23:17:09.007887 | b787870c-85db-4ba7-bef3-c22b5862facc ==============================
[0m23:17:09.007887 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:17:09.010759 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models average_exchange_rate_monthly', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:17:09.877118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b787870c-85db-4ba7-bef3-c22b5862facc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a16f40880>]}
[0m23:17:10.059990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b787870c-85db-4ba7-bef3-c22b5862facc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a17116ef0>]}
[0m23:17:10.061870 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:17:10.273275 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m23:17:10.571842 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:17:10.573665 [debug] [MainThread]: Partial parsing: updated file: dbt_prj://models/average_exchange_rate_monthly.sql
[0m23:17:11.360302 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m23:17:11.380173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b787870c-85db-4ba7-bef3-c22b5862facc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a16190130>]}
[0m23:17:11.670810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b787870c-85db-4ba7-bef3-c22b5862facc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a16142b30>]}
[0m23:17:11.672718 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:17:11.674167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b787870c-85db-4ba7-bef3-c22b5862facc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a16142fb0>]}
[0m23:17:11.681051 [info ] [MainThread]: 
[0m23:17:11.684007 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:17:11.687689 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:17:11.725013 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:17:12.547947 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:17:12.569202 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:17:12.890926 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m23:17:12.909089 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m23:17:12.927060 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:17:12.932888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b787870c-85db-4ba7-bef3-c22b5862facc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a16143eb0>]}
[0m23:17:12.934516 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:17:12.935636 [info ] [MainThread]: 
[0m23:17:12.946366 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:12.949698 [info ] [Thread-1 (]: 1 of 1 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m23:17:12.953174 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m23:17:12.954810 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:12.976607 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:17:12.978214 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:13.033976 [debug] [Thread-1 (]: Creating new relation average_exchange_rate_monthly
[0m23:17:13.061193 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:17:13.062877 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    'EUR' as from_currency,
    'USD' as to_currency,
    AVG(rate)
FROM raw_data
GROUP BY month
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:17:13.076704 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:13.143813 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b787870c-85db-4ba7-bef3-c22b5862facc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a16ed15a0>]}
[0m23:17:13.145870 [info ] [Thread-1 (]: 1 of 1 OK created sql view model `default`.`average_exchange_rate_monthly` ..... [[32mOK[0m in 0.19s]
[0m23:17:13.148448 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:13.155482 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:17:13.156460 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_monthly' was left open.
[0m23:17:13.157323 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_monthly: Close
[0m23:17:13.158386 [info ] [MainThread]: 
[0m23:17:13.160438 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.48 seconds (1.48s).
[0m23:17:13.163533 [debug] [MainThread]: Command end result
[0m23:17:13.255358 [info ] [MainThread]: 
[0m23:17:13.257146 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:17:13.259786 [info ] [MainThread]: 
[0m23:17:13.263665 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:17:13.266385 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.438109, "process_in_blocks": "0", "process_kernel_time": 0.378697, "process_mem_max_rss": "133300", "process_out_blocks": "2992", "process_user_time": 8.102134}
[0m23:17:13.267784 [debug] [MainThread]: Command `dbt run` succeeded at 23:17:13.267486 after 4.44 seconds
[0m23:17:13.268747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a18affbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a16f3de10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a18dfcc40>]}
[0m23:17:13.269848 [debug] [MainThread]: Flushing usage events
[0m23:17:13.921234 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:17:27.129649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37db177bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d9712fe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d9713e20>]}


============================== 23:17:27.138468 | dca3855a-6e30-49bd-9ce3-64271779be67 ==============================
[0m23:17:27.138468 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:17:27.140510 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/root/sobes_project/test_task/dbt/logs', 'profiles_dir': '/root/sobes_project/test_task/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:17:27.692104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d97833d0>]}
[0m23:17:27.879994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d97829b0>]}
[0m23:17:27.882777 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:17:28.124472 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m23:17:28.448501 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:17:28.449833 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:17:28.472502 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt
[0m23:17:28.555331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d909d9f0>]}
[0m23:17:28.875723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d909e3b0>]}
[0m23:17:28.878321 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:17:28.880005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d909e230>]}
[0m23:17:28.887239 [info ] [MainThread]: 
[0m23:17:28.889898 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:17:28.929847 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:17:28.983970 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:17:29.809129 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:17:29.820562 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:29.909258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__default)
[0m23:17:29.949133 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__default: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "connection_name": "list__default"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'default'
      

  ...
[0m23:17:29.975781 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:17:29.986482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d9688970>]}
[0m23:17:29.989562 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:17:29.991917 [info ] [MainThread]: 
[0m23:17:30.002992 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:30.006307 [info ] [Thread-1 (]: 1 of 2 START sql view model `default`.`average_exchange_rate_monthly` .......... [RUN]
[0m23:17:30.008938 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__default, now model.dbt_prj.average_exchange_rate_monthly)
[0m23:17:30.011179 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:30.043800 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:17:30.045789 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:30.210656 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_monthly"
[0m23:17:30.213725 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */


  create view `default`.`average_exchange_rate_monthly__dbt_tmp` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfMonth(ExecutionTime) AS month,
        AVG(EUR_to_X / USD_to_X) as rate
    FROM default.ECB_table
    GROUP BY month
    HAVING from_currency = 'EUR' and to_currency = 'USD'
)

SELECT
    month,
    'EUR' as from_currency,
    'USD' as to_currency,
    AVG(rate)
FROM raw_data
GROUP BY month
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:17:30.232717 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:17:30.262370 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */

    drop table if exists `default`.`average_exchange_rate_monthly__dbt_backup` 
  
  ...
[0m23:17:30.269558 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.273798 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */

    rename table `default`.`average_exchange_rate_monthly` to `default`.`average_exchange_rate_monthly__dbt_backup` 
  
  ...
[0m23:17:30.280722 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.291702 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */

    drop table if exists `default`.`average_exchange_rate_monthly` 
  
  ...
[0m23:17:30.301147 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.307945 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */

    rename table `default`.`average_exchange_rate_monthly__dbt_tmp` to `default`.`average_exchange_rate_monthly` 
  
  ...
[0m23:17:30.316999 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.413062 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_monthly"} */

    drop table if exists `default`.`average_exchange_rate_monthly__dbt_backup` 
  ...
[0m23:17:30.421811 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.441748 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d9688970>]}
[0m23:17:30.444445 [info ] [Thread-1 (]: 1 of 2 OK created sql view model `default`.`average_exchange_rate_monthly` ..... [[32mOK[0m in 0.43s]
[0m23:17:30.448640 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_monthly
[0m23:17:30.452445 [debug] [Thread-1 (]: Began running node model.dbt_prj.average_exchange_rate_weekly
[0m23:17:30.464816 [info ] [Thread-1 (]: 2 of 2 START sql view model `default`.`average_exchange_rate_weekly` ........... [RUN]
[0m23:17:30.469154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_prj.average_exchange_rate_monthly, now model.dbt_prj.average_exchange_rate_weekly)
[0m23:17:30.471766 [debug] [Thread-1 (]: Began compiling node model.dbt_prj.average_exchange_rate_weekly
[0m23:17:30.488944 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_prj.average_exchange_rate_weekly"
[0m23:17:30.492249 [debug] [Thread-1 (]: Began executing node model.dbt_prj.average_exchange_rate_weekly
[0m23:17:30.627480 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_prj.average_exchange_rate_weekly"
[0m23:17:30.629625 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */


  create view `default`.`average_exchange_rate_weekly__dbt_tmp` 
  
    
    
  as (
    WITH raw_data AS (
    SELECT
        toStartOfWeek(ExecutionTime, 1) AS start_of_week,    
        CharCode AS from_currency,                       
        'USD' AS to_currency,                            
        AVG(Value) AS average_rate                       
    FROM default.ECB_table 
    GROUP BY start_of_week, from_currency, to_currency
)

SELECT
    start_of_week,
    from_currency,
    to_currency,
    average_rate AS rate
FROM raw_data
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:17:30.645268 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.656285 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    drop table if exists `default`.`average_exchange_rate_weekly__dbt_backup` 
  
  ...
[0m23:17:30.663873 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.667716 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    rename table `default`.`average_exchange_rate_weekly` to `default`.`average_exchange_rate_weekly__dbt_backup` 
  
  ...
[0m23:17:30.675197 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.685872 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    drop table if exists `default`.`average_exchange_rate_weekly` 
  
  ...
[0m23:17:30.692970 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.699266 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    rename table `default`.`average_exchange_rate_weekly__dbt_tmp` to `default`.`average_exchange_rate_weekly` 
  
  ...
[0m23:17:30.707577 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.720325 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.dbt_prj.average_exchange_rate_weekly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_profile", "target_name": "dev", "node_id": "model.dbt_prj.average_exchange_rate_weekly"} */

    drop table if exists `default`.`average_exchange_rate_weekly__dbt_backup` 
  ...
[0m23:17:30.727890 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:17:30.732746 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca3855a-6e30-49bd-9ce3-64271779be67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d94c86d0>]}
[0m23:17:30.735146 [info ] [Thread-1 (]: 2 of 2 OK created sql view model `default`.`average_exchange_rate_weekly` ...... [[32mOK[0m in 0.27s]
[0m23:17:30.737759 [debug] [Thread-1 (]: Finished running node model.dbt_prj.average_exchange_rate_weekly
[0m23:17:30.742578 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:17:30.743728 [debug] [MainThread]: Connection 'model.dbt_prj.average_exchange_rate_weekly' was left open.
[0m23:17:30.744685 [debug] [MainThread]: On model.dbt_prj.average_exchange_rate_weekly: Close
[0m23:17:30.746269 [info ] [MainThread]: 
[0m23:17:30.748248 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.86 seconds (1.86s).
[0m23:17:30.751478 [debug] [MainThread]: Command end result
[0m23:17:30.872251 [info ] [MainThread]: 
[0m23:17:30.874138 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:17:30.875591 [info ] [MainThread]: 
[0m23:17:30.877028 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m23:17:30.879602 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.0061436, "process_in_blocks": "0", "process_kernel_time": 0.399171, "process_mem_max_rss": "128992", "process_out_blocks": "2040", "process_user_time": 7.344762}
[0m23:17:30.881129 [debug] [MainThread]: Command `dbt run` succeeded at 23:17:30.880725 after 4.01 seconds
[0m23:17:30.882811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37db177bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d2e6b0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f37d2e68850>]}
[0m23:17:30.884493 [debug] [MainThread]: Flushing usage events
[0m23:17:31.434379 [debug] [MainThread]: An error was encountered while trying to flush usage events
